# Clerk: Frontend Setup (`<ClerkProvider>`)

Configuring the Clerk context provider in your frontend application.

## Core Concept: `<ClerkProvider>`

The `<ClerkProvider>` component is the root of Clerk's functionality in your frontend application (React, Next.js, etc.). It wraps your application (or relevant parts of it) and provides the necessary context for Clerk components and hooks (`<SignIn>`, `<UserButton>`, `useUser`, `useAuth`, etc.) to function correctly.

**Key Responsibilities:**

*   Initializes the Clerk frontend SDK.
*   Requires your **Publishable Key** (`pk_test_...` or `pk_live_...`).
*   Manages the active session and user state on the client-side.
*   Provides configuration options for appearance, routing, and localization.

## Setup in Different Frameworks

**1. Next.js (App Router):**

*   **Location:** Wrap the contents of your root layout (`src/app/layout.tsx`).
*   **Key:** Pass the publishable key directly (it's safe, but using env vars is better practice). Clerk automatically reads `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` if available.
*   **Appearance/Localization:** Can be configured via props or globally in the Clerk dashboard.

```typescript
// src/app/layout.tsx
import { ClerkProvider } from '@clerk/nextjs';
import type { Metadata } from 'next';
import './globals.css';

export const metadata: Metadata = {
  title: 'My Clerk App',
  description: 'Generated by create next app',
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    // Wrap the entire application, including <html> and <body>
    <ClerkProvider
      // publishableKey={process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY} // Optional: Key read automatically if env var set
      // appearance={{ baseTheme: dark }} // Example customization
    >
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  );
}
```

**2. Next.js (Pages Router):**

*   **Location:** Wrap the `Component` in your custom `_app.tsx` file.
*   **Key:** Pass the publishable key via the `publishableKey` prop, preferably using `process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`.

```typescript
// src/pages/_app.tsx
import { ClerkProvider } from '@clerk/nextjs';
import type { AppProps } from 'next/app';
import '../styles/globals.css';

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider
      {...pageProps} // Pass pageProps
      publishableKey={process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}
    >
      <Component {...pageProps} />
    </ClerkProvider>
  );
}

export default MyApp;
```

**3. Create React App (CRA) / Vite React:**

*   **Location:** Wrap your root `<App />` component in `src/index.tsx` or `src/main.tsx`.
*   **Key:** Pass the publishable key via the `publishableKey` prop, using the appropriate environment variable syntax (e.g., `import.meta.env.VITE_CLERK_PUBLISHABLE_KEY` for Vite).
*   **Routing:** Requires integration with your chosen router (e.g., React Router) for navigation props.

```typescript
// src/main.tsx (Vite example)
import React from 'react';
import ReactDOM from 'react-dom/client';
import { ClerkProvider, SignIn, SignUp, RedirectToSignIn } from '@clerk/clerk-react';
import { BrowserRouter, Routes, Route, useNavigate } from 'react-router-dom'; // Example with React Router
import App from './App';
import './index.css';

const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY;

if (!PUBLISHABLE_KEY) {
  throw new Error("Missing Publishable Key");
}

function ClerkProviderWithRoutes() {
  const navigate = useNavigate();

  return (
    <ClerkProvider
      routerPush={(to) => navigate(to)}
      routerReplace={(to) => navigate(to, { replace: true })}
      publishableKey={PUBLISHABLE_KEY}
    >
      <Routes>
        <Route path="/" element={<App />} />
        <Route
          path="/sign-in/*" // Clerk components handle sub-routes
          element={<SignIn routing="path" path="/sign-in" />}
        />
        <Route
          path="/sign-up/*"
          element={<SignUp routing="path" path="/sign-up" />}
        />
        {/* Example Protected Route */}
        <Route
          path="/protected"
          element={
            <>
              <SignedIn> <ProtectedPage /> </SignedIn>
              <SignedOut> <RedirectToSignIn /> </SignedOut>
            </>
          }
        />
      </Routes>
    </ClerkProvider>
  );
}

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <BrowserRouter> {/* Wrap with Router */}
      <ClerkProviderWithRoutes />
    </BrowserRouter>
  </React.StrictMode>,
);

function ProtectedPage() { return <h2>Protected Content</h2>; } // Placeholder
```

**4. Remix:**

*   **Location:** Wrap the application in your root boundary (`app/root.tsx`).
*   **Key:** Pass the publishable key via environment variable.
*   **Loader:** Requires a root loader function to pass the key from the server environment to the client-side provider.

```typescript
// app/root.tsx (Remix Example - Simplified)
import { ClerkApp, ClerkErrorBoundary } from "@clerk/remix";
import { rootAuthLoader } from "@clerk/remix/ssr.server"; // Server-side loader
import type { LoaderFunctionArgs } from "@remix-run/node";
import { Outlet, Links, Meta, Scripts } from "@remix-run/react";

export const loader = (args: LoaderFunctionArgs) => {
  // Load auth state server-side and pass publishable key
  return rootAuthLoader(args, ({ loadSession, loadUser }) => {
    // Optional: load user/session data server-side if needed immediately
    // await loadSession();
    // await loadUser();
    return { publishableKey: process.env.CLERK_PUBLISHABLE_KEY };
  });
};

export const ErrorBoundary = ClerkErrorBoundary();

function App() {
  return (
    <html>
      <head>
        <Meta />
        <Links />
      </head>
      <body>
        <Outlet />
        <Scripts />
      </body>
    </html>
  );
}

export default ClerkApp(App); // Wrap App with ClerkApp HOC
```

**Key Props for `<ClerkProvider>`:**

*   `publishableKey`: Your publishable API key (required if not using Next.js env var).
*   `routerPush`, `routerReplace`: (For non-Next.js routers) Functions to integrate with your router's navigation methods.
*   `appearance`: Object for customizing the look and feel (see Clerk docs).
*   `localization`: Object for customizing text and language (see Clerk docs).
*   `initialState`: (SSR frameworks) Used to pass server-side auth state to the client. Handled automatically by framework helpers like `rootAuthLoader` in Remix.

Correctly setting up `<ClerkProvider>` at the root of your application is the first essential step for integrating Clerk's frontend features.

*(Refer to the official Clerk documentation for framework-specific setup guides.)*