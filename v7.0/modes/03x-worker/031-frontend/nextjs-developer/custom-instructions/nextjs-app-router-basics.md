# Next.js: App Router Basics

Understanding the fundamental file conventions and concepts of the Next.js App Router.

## Core Concept: App Router (`app/` Directory)

Introduced in Next.js 13, the App Router provides a new paradigm for building applications, centered around React Server Components and a file-system based routing mechanism within the `app/` directory.

**Key Principles:**

*   **Server Components by Default:** Components within the `app/` directory are React Server Components (RSCs) unless explicitly marked with `'use client'`. RSCs render entirely on the server (or at build time) and cannot use hooks like `useState` or `useEffect`, or browser-only APIs.
*   **File Conventions:** Special file names within folders define UI components for specific route segments:
    *   `layout.tsx` / `.js`: Defines shared UI that wraps child segments. Required at the root.
    *   `page.tsx` / `.js`: Defines the unique UI for a specific route segment. Makes the route publicly accessible.
    *   `loading.tsx` / `.js`: Defines loading UI shown via React Suspense while child segments load.
    *   `error.tsx` / `.js`: Defines error UI boundary for a segment. Must be a Client Component. Catches errors in nested child segments.
    *   `template.tsx` / `.js`: Similar to `layout`, but re-mounts on navigation (state is not preserved). Less common.
    *   `route.ts` / `.js`: Defines API endpoints (Route Handlers).
*   **Colocation:** Components, styles, tests, and related files can be colocated within route segment folders in the `app/` directory.

## Basic Structure & Files

```
app/
├── layout.tsx        # Root Layout (Required: <html>, <body>)
├── page.tsx          # Root Page (Homepage UI at '/')
├── globals.css       # Global Styles (imported in root layout)
│
├── dashboard/        # Route Segment for '/dashboard'
│   ├── layout.tsx    # Layout specific to '/dashboard' and its children
│   ├── page.tsx      # Page UI for '/dashboard'
│   ├── settings/     # Nested Route Segment for '/dashboard/settings'
│   │   └── page.tsx  # Page UI for '/dashboard/settings'
│   └── loading.tsx   # Loading UI for '/dashboard' segment children
│
├── blog/             # Route Segment for '/blog'
│   ├── [slug]/       # Dynamic Route Segment for '/blog/[slug]'
│   │   ├── page.tsx  # Page UI for individual blog posts
│   │   └── error.tsx # Error UI specific to blog post rendering
│   └── page.tsx      # Page UI for '/blog' (listing posts)
│
└── api/              # Route Segment for API endpoints
    └── users/
        └── route.ts  # API endpoint at '/api/users'
```

**1. `layout.tsx` (Root Layout - Required):**

*   Defines the root `<html>` and `<body>` tags.
*   Wraps all other page and layout components.
*   Used for global styles, context providers, main navigation structure (header, footer).
*   Receives `children` prop representing the child segment (page or nested layout).
*   Must be a Server Component (cannot use `'use client'`).

```typescript
// app/layout.tsx
import type { Metadata } from 'next';
import './globals.css';
// import Header from '@/components/Header'; // Example shared component

export const metadata: Metadata = {
  title: 'My Next App',
  description: 'Generated by create next app',
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body>
        {/* <Header /> */}
        <main>{children}</main> {/* Child page/layout rendered here */}
        {/* Footer? */}
      </body>
    </html>
  );
}
```

**2. `page.tsx`:**

*   Defines the primary UI for a route segment.
*   Makes a route segment publicly accessible.
*   Can be a Server Component (default) or a Client Component (`'use client'`).
*   Server Components can be `async` to fetch data directly.

```typescript
// app/page.tsx (Homepage)
// Server Component by default
export default function HomePage() {
  return <h1>Welcome Home!</h1>;
}

// app/dashboard/page.tsx
// Example Server Component fetching data
async function getDashboardData() { /* ... fetch logic ... */ return { count: 123 }; }

export default async function DashboardPage() {
  const data = await getDashboardData();
  return (
    <div>
      <h1>Dashboard</h1>
      <p>Data count: {data.count}</p>
    </div>
  );
}
```

**3. `loading.tsx`:**

*   Automatically wraps `page.tsx` and its children in a React `<Suspense>` boundary.
*   Displays instantly on navigation while the route segment's content loads.
*   Can be a Server or Client Component.

```typescript
// app/dashboard/loading.tsx
export default function Loading() {
  // You can add any UI inside Loading, including a Skeleton.
  return <p>Loading dashboard data...</p>;
  // Or return <DashboardSkeleton />;
}
```

**4. `error.tsx`:**

*   Automatically wraps `page.tsx` and its children in a React Error Boundary.
*   Displays if an error occurs within the route segment or its children.
*   **Must be a Client Component (`'use client'`)**.
*   Receives `error` (the Error object) and `reset` (a function to attempt re-rendering the segment) as props.

```typescript
// app/blog/[slug]/error.tsx
'use client'; // Error components must be Client Components

import { useEffect } from 'react';
import Button from '@mui/material/Button'; // Example using MUI

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  useEffect(() => {
    // Log the error to an error reporting service
    console.error(error);
  }, [error]);

  return (
    <div>
      <h2>Something went wrong loading this post!</h2>
      <p>{error.message}</p>
      <Button
        variant="contained"
        onClick={
          // Attempt to recover by trying to re-render the segment
          () => reset()
        }
      >
        Try again
      </Button>
    </div>
  );
}
```

Understanding these core file conventions is essential for structuring applications using the Next.js App Router.

*(Refer to the official Next.js documentation on the App Router, Routing, Layouts, Pages, Loading UI, and Error Handling.)*