+++
id = "PRIME-RULE-META-TOOL-HANDLING-V3" # Incremented version
title = "Prime Coordinator: Rule - Meta-Discussion Tool Output Handling"
context_type = "rules"
scope = "Handling the display or referencing of tool usage during meta-discussions"
target_audience = ["prime-coordinator"] # This instance is for prime-coordinator
granularity = "guideline"
status = "active"
last_updated = "2025-05-02" # Use current date
tags = ["rules", "meta-discussion", "tool-use", "safety", "prime", "logging", "analysis", "file-output"]
related_context = [
    "01-operational-principles.md",
    ".roo/rules/03-standard-tool-use-xml-syntax.md",
    ".roo/rules/08-logging-procedure-simplified.md" # Logging rule for file creation
    ]
template_schema_doc = ".ruru/templates/toml-md/16_ai_rule.README.md"
relevance = "High: Prevents accidental tool execution during analysis/troubleshooting"
+++

# Rule: Meta-Discussion Tool Output Handling

**Objective:** To prevent accidental tool execution when discussing or analyzing previous interactions, logs, or mode behavior that involves tool usage syntax, while still allowing access to exact syntax details when necessary.

**Applies To:** `prime-coordinator` (A corresponding rule MUST exist for `roo-commander`).

**Rule:**

1.  **Identify Context:** When processing user input, provided content (like chat logs or file content), or formulating responses, carefully assess if the context clearly indicates a **meta-discussion**. This includes:
    *   Analyzing or reviewing past chat logs or MDTM task logs.
    *   Troubleshooting mode behavior or errors related to tool use.
    *   Discussing potential improvements to modes, rules, or workflows involving tool interactions.
    *   Responding to user feedback about specific tool interactions.
    *   Any situation where the user explicitly states they are discussing *past* tool use and do *not* want tools executed.

2.  **Strictly Avoid Direct Tool XML Output in Chat:** If the context is identified as a meta-discussion:
    *   **MUST NOT** output text formatted according to the standard tool usage XML syntax directly into the chat response.
    *   **MUST NOT** output text that mimics the tool usage XML syntax directly into the chat response, even if escaped (e.g., using backticks or other methods).

3.  **Describe or Offer File Output:** When referencing a specific tool use from the analyzed content:
    *   **Default Action:** Describe the tool use in plain text or standard Markdown, focusing on the *action*, *tool name*, and key *parameters* without using the XML structure.
        *   *Example Description:* "In the log, the mode then used the `read_file` tool, specifying the path `.ruru/workflows/WF-REPOMIX-V2/README.md`."
    *   **Alternative (Offer File Output):** If a simple description seems insufficient, or if the exact XML syntax might be important for the discussion (e.g., debugging complex parameters), **offer to write the detailed tool usage information (including the raw XML block) to a temporary file.**
        *   Use `ask_followup_question` to propose this to the user.
        *   If the user agrees:
            *   Generate a unique filename (e.g., `YYYYMMDDHHMMSS-tool-details.txt`).
            *   Use `write_to_file` to save the detailed information (including the raw XML) to `.ruru/docs/meta_discussion/[filename]`. Ensure this directory exists or can be created.
            *   Report the full path of the created file to the user.
            *   Log the creation of this file (Rule `08-logging-procedure-simplified.md`).

4.  **Self-Correction Check:** Before sending any response (including those generated by steps 1-3), perform a final check on the response content. If the response contains any text matching the pattern `<tool_name>...</tool_name>` that is *not* the single, intended tool call for execution in the *next* turn, **MUST** rephrase the response to describe the tool use (as per point 3a) instead of including the raw XML. This acts as a final safety net against accidental XML leakage.

**5. Rationale:** This approach prioritizes safety by keeping executable syntax out of the main chat flow during meta-discussions. It provides a default descriptive method, a secondary option to safely export exact details to a file upon user request, and a final self-correction check, facilitating deeper analysis when needed without risking accidental execution.