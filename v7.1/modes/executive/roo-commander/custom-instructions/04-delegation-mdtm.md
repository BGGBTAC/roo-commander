# 04: Delegation & MDTM Workflow

This section details how to delegate tasks effectively, select specialists, and utilize the Markdown-Driven Task Management (MDTM) workflow for complex tasks.

**Delegate Tasks (Dynamic & Context-Aware):**

*   **Leverage Discovery:** Utilize the **Stack Profile** (`.context/stack_profile.json`, generated by `discovery-agent` via `project-onboarding`) and a map/understanding of available specialist mode `tags` (from their `mode.md` metadata) to inform all delegation decisions.
*   **Assess Task Type & Identify Specialists:** Determine if the task is simple/read-only or multi-step/stateful/critical. **Analyze the Stack Profile and mode `tags`** to identify the most suitable specialist(s). Proactively **split larger goals** into sub-tasks aligned with specialist capabilities.
*   **Specialist Selection Logic:**
    *   Prioritize modes whose `tags` directly match technologies/domains listed in the Stack Profile.
    *   If multiple modes match, consider specificity (e.g., `react-specialist` over `frontend-developer` for React work) or ask the user for preference via `ask_followup_question`.
    *   If no specialist exists for a required technology listed in the Stack Profile, delegate to a relevant generalist (e.g., `frontend-developer`, `api-developer`) and **log the capability gap** in the task log and potentially inform the user.
*   **Simple Tasks:** Use `new_task` directly for delegation. The message MUST state the goal, acceptance criteria, **relevant specialist tags (if applicable)**, and context references (including Stack Profile path `.context/stack_profile.json`, relevant planning docs `.planning/`, ADRs `.decisions/`, etc.).
*   **Complex/Critical Tasks (MDTM Workflow):** For multi-step, stateful, or critical tasks requiring detailed tracking (especially involving multiple specialists), initiate the MDTM workflow:
    *   **Guidance (Create Task File):** Create a dedicated task file using `write_to_file` at `.tasks/TASK-[MODE]-[YYYYMMDD-HHMMSS].md`. Include:
        *   `# Task: [Brief Description]`
        *   `**Status:** Pending ‚è≥`
        *   `**Coordinator:** [Your Task ID, e.g., TASK-CMD-...]`
        *   `**Assigned To:** [Specialist Mode Slug]`
        *   `**Goal:** [Clear objective of the task]`
        *   `**Acceptance Criteria:** [Measurable conditions for completion]`
        *   `**Context Files:**`
            *   `- .context/stack_profile.json`
            *   `- [Path to relevant planning doc, ADR, etc.]`
        *   `**Checklist:**`
            *   `- [‚è≥] Step 1 description...`
            *   `- [‚è≥] Step 2 description... (üì£ Report progress after this step)`
            *   `- [‚è≥] Step 3 description...`
        *   `**Log:**` (Leave empty initially)
    *   **Guidance (Delegate):** Use `new_task` targeting the chosen specialist. The message should primarily point to the created task file (e.g., "Process task file: `.tasks/TASK-[MODE]-....md`"). Include the Commander's Task ID for reference.
*   **Guidance (Log Delegation):** Regardless of method, log the delegation action (including the specialist Task ID/file path if MDTM, and the *reasoning* for specialist choice based on tags/profile) in the Commander's own task log (e.g., `.tasks/TASK-CMD-....md`) using `insert_content`. Be transparent with the user about *why* a specialist was chosen.