<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roo Code Mode Filter</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 20px;
            line-height: 1.6;
            background-color: #f8f9fa;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: #007bff;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        textarea {
            width: 95%; /* Adjusted width */
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            min-height: 150px;
            resize: vertical;
            background-color: #fff; /* Ensure background is white */
            color: #333; /* Ensure text color is dark */
        }
        button, .file-upload-label {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            margin-right: 10px;
            transition: background-color 0.2s ease;
            display: inline-block; /* Needed for label styling */
            vertical-align: middle; /* Align with other buttons */
            margin-bottom: 10px; /* Spacing */
        }
        button:hover, .file-upload-label:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #fileInput {
            display: none; /* Hide the actual file input */
        }
        .input-area {
             border: 1px solid #eee;
             padding: 15px;
             margin-bottom: 20px;
             border-radius: 5px;
        }
        #modeListContainer {
             margin-top: 20px;
        }
        #modeList {
            margin-top: 10px;
            padding: 15px;
            border: 1px dashed #ddd;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            background-color: #fdfdfd;
        }
        #modeList div {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
         #modeList input[type="checkbox"] {
            margin-right: 10px;
            cursor: pointer;
            transform: scale(1.1); /* Slightly larger checkboxes */
        }
        #modeList label {
            font-weight: normal;
            margin-bottom: 0;
            cursor: pointer;
            flex-grow: 1; /* Allow label to take space */
        }
        #errorDisplay, #fileInfo {
            color: #dc3545;
            margin-top: 15px;
            font-weight: bold;
            min-height: 1.2em; /* Reserve space */
        }
        #fileInfo {
             color: #28a745; /* Green for success */
        }
        pre {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap; /* Wrap long lines */
            word-wrap: break-word; /* Break words if necessary */
        }
        code {
             font-family: monospace;
             font-size: 0.9em;
             color: #333;
        }
        .button-group button {
            margin-right: 5px;
            background-color: #6c757d;
        }
         .button-group button:hover {
            background-color: #5a6268;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>Roo Code Mode Filter</h1>

    <p>Paste the full JSON content of a Roo Code custom_modes.json file into the input area below or select the file from your computer, click load the modes, select the ones you want, and generate the filtered JSON. For detailed explanations of each mode and how they work together, please refer to the main README.md file in the <a href="https://github.com/jezweb/roo-commander" target="_blank" rel="noopener noreferrer">repository</a>.</p>

    <div class="input-area">
        <h2>Input Method</h2>
        <div>
            <label for="jsonInput">Option 1: Paste JSON</label>
            <textarea id="jsonInput" placeholder="Paste your Roo Code JSON here..."></textarea>
        </div>
        <div>
            <label for="fileInput" class="file-upload-label">Option 2: Upload JSON/TXT File</label>
            <input type="file" id="fileInput" accept=".json,.txt">
            <div id="fileInfo"></div>
        </div>
        <button id="loadButton">Load Modes from Input</button>
    </div>

    <div id="errorDisplay"></div>

    <div id="modeListContainer" style="display: none;">
        <h2>Select Modes:</h2>
        <div class="button-group">
             <button id="selectAllButton">Select All</button>
             <button id="selectNoneButton">Select None</button>
        </div>
        <div id="modeList">
            <!-- Mode checkboxes will be populated here -->
            <p>Load JSON first to see modes.</p>
        </div>
        <button id="generateButton" style="margin-top: 20px;" disabled>Generate Filtered JSON</button>
    </div>


    <div id="outputContainer" style="display: none;">
        <h2>Filtered JSON Output:</h2>
        <label for="jsonOutput">Result:</label>
        <textarea id="jsonOutput" readonly placeholder="Filtered JSON will appear here..."></textarea>
    </div>

</div>

<script>
    const jsonInput = document.getElementById('jsonInput');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const loadButton = document.getElementById('loadButton');
    const modeListDiv = document.getElementById('modeList');
    const modeListContainer = document.getElementById('modeListContainer');
    const generateButton = document.getElementById('generateButton');
    const jsonOutput = document.getElementById('jsonOutput');
    const outputContainer = document.getElementById('outputContainer');
    const errorDisplay = document.getElementById('errorDisplay');
    const selectAllButton = document.getElementById('selectAllButton');
    const selectNoneButton = document.getElementById('selectNoneButton');

    let allModesData = []; // To store the original mode objects

    // --- File Upload Handling ---
    fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) {
            fileInfo.textContent = '';
            return;
        }

        // Basic type check (though 'accept' attribute is primary)
        if (!file.type.includes('json') && file.type !== 'text/plain') {
             errorDisplay.textContent = 'Warning: Selected file is not JSON or TXT. Attempting to read anyway.';
        } else {
             errorDisplay.textContent = ''; // Clear previous warnings/errors
        }


        const reader = new FileReader();

        reader.onload = (e) => {
            try {
                jsonInput.value = e.target.result; // Put file content into textarea
                fileInfo.textContent = `File "${file.name}" loaded into textarea. Click 'Load Modes'.`;
                errorDisplay.textContent = ''; // Clear errors on successful load
            } catch (err) {
                 console.error("Error setting textarea value:", err);
                 errorDisplay.textContent = "Error displaying file content.";
                 fileInfo.textContent = '';
            }
        };

        reader.onerror = (e) => {
            console.error("FileReader Error:", e);
            errorDisplay.textContent = `Error reading file: ${file.name}`;
            fileInfo.textContent = '';
            jsonInput.value = ''; // Clear textarea on read error
        };

        reader.readAsText(file); // Read the file as text
    });


    // --- Load Modes Button ---
    loadButton.addEventListener('click', () => {
        modeListDiv.innerHTML = ''; // Clear previous list
        jsonOutput.value = ''; // Clear previous output
        outputContainer.style.display = 'none'; // Hide output
        errorDisplay.textContent = ''; // Clear errors
        generateButton.disabled = true; // Disable generate button
        selectAllButton.disabled = true;
        selectNoneButton.disabled = true;
        modeListContainer.style.display = 'none'; // Hide mode list initially
        allModesData = [];

        const jsonString = jsonInput.value.trim();
        if (!jsonString) {
            errorDisplay.textContent = 'Input JSON (from paste or file) cannot be empty.';
            return;
        }

        fileInfo.textContent = ''; // Clear file loaded message

        try {
            const parsedJson = JSON.parse(jsonString);

            if (!parsedJson.customModes || !Array.isArray(parsedJson.customModes)) {
                errorDisplay.textContent = 'Invalid JSON format: Missing or invalid "customModes" array.';
                modeListDiv.innerHTML = '<p>Invalid JSON format.</p>';
                modeListContainer.style.display = 'block'; // Show container even on error
                return;
            }

            allModesData = parsedJson.customModes; // Store the data

            if (allModesData.length === 0) {
                 modeListDiv.innerHTML = '<p>No modes found in the provided JSON.</p>';
                 modeListContainer.style.display = 'block'; // Show container
                 return;
            }

            // Sort modes alphabetically by name for better display
            allModesData.sort((a, b) => (a.name || '').localeCompare(b.name || ''));

            allModesData.forEach(mode => {
                // Basic validation of mode object
                if (mode && mode.slug && mode.name) {
                    const div = document.createElement('div');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `mode-${mode.slug}`;
                    checkbox.value = mode.slug; // Use slug as the identifier
                    checkbox.checked = true; // Default to checked
                    checkbox.dataset.name = mode.name; // Store name for potential future use

                    const label = document.createElement('label');
                    label.htmlFor = `mode-${mode.slug}`;
                    label.textContent = mode.name; // Display the mode name

                    div.appendChild(checkbox);
                    div.appendChild(label);
                    modeListDiv.appendChild(div);
                } else {
                    console.warn("Skipping invalid mode object:", mode);
                }
            });

            modeListContainer.style.display = 'block'; // Show the list container
            generateButton.disabled = false; // Enable generate button
            selectAllButton.disabled = false;
            selectNoneButton.disabled = false;

        } catch (error) {
            console.error("JSON Parsing Error:", error);
            errorDisplay.textContent = `Error parsing JSON: ${error.message}`;
            modeListDiv.innerHTML = '<p>Error loading modes. Check JSON format.</p>';
            modeListContainer.style.display = 'block'; // Show container even on error
        }
    });

    // --- Select All / None Buttons ---
    selectAllButton.addEventListener('click', () => {
        const checkboxes = modeListDiv.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => checkbox.checked = true);
    });

    selectNoneButton.addEventListener('click', () => {
        const checkboxes = modeListDiv.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => checkbox.checked = false);
    });


    // --- Generate Button ---
    generateButton.addEventListener('click', () => {
        const selectedSlugs = [];
        const checkboxes = modeListDiv.querySelectorAll('input[type="checkbox"]:checked');

        checkboxes.forEach(checkbox => {
            selectedSlugs.push(checkbox.value);
        });

        // Filter the original allModesData based on selected slugs
        // Maintain original order if needed, or keep sorted order
        // Let's filter the already sorted allModesData
        const filteredModes = allModesData.filter(mode => mode && mode.slug && selectedSlugs.includes(mode.slug));

        // Create the output structure
        const outputJson = {
            customModes: filteredModes
        };

        // Display the filtered JSON beautifully formatted
        jsonOutput.value = JSON.stringify(outputJson, null, 2); // Pretty print with 2 spaces
        outputContainer.style.display = 'block'; // Show output area
        errorDisplay.textContent = ''; // Clear any previous errors
    });

    // Initial state
    selectAllButton.disabled = true;
    selectNoneButton.disabled = true;


</script>

</body>
</html>
